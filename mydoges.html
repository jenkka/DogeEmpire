<!doctype html>
<html lang="en">
  <head>
    <title>Doge Empire</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/theme_1618793627092.css">
  </head>
  <body style="text-align: center;">
    <nav class="navbar navbar-expand-sm navbar-dark bg-primary">
        <a href="index.html">
            <img class="mr-2" src="./img/dog.png" style="width: 50px;" href="#"/>
            
        </a>
        <a class="navbar-brand" href="index.html">Doge Empire</a>
        <button class="navbar-toggler d-lg-none" type="button" data-toggle="collapse" data-target="#collapsibleNavId" aria-controls="collapsibleNavId"
            aria-expanded="false" aria-label="Toggle navigation"></button>
        <div class="collapse navbar-collapse" id="collapsibleNavId">
            <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="doges.html">Doges</a>
                </li>
                <li class="nav-item" id="login-menu-button">
                    <a class="nav-link " href="" data-toggle="modal" data-target="#login-modal">Log in</a>
                </li>
                <li class="nav-item active" id="mydoges-menu-button">
                    <a class="nav-link " href="mydoges.html">My doges</a>
                </li>
                <li class="nav-item" id="register-doge-menu-button">
                    <a class="nav-link " href="" data-toggle="modal" data-target="#doge-register-modal">Register a doge</a>
                </li>
                <li class="nav-item" id="logout-menu-button">
                    <a class="nav-link " href="">Log out</a>
                </li>
            </ul>
        </div>
    </nav>
    <div id="alerts"></div>

    <div class="form-group my-4 text-center">
        <div class="dropdown col-3" style="display: inline;"> 
            <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" id="current-filter">Name
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li><a href="#" id="name-filter">Name</a></li>
                <li><a href="#" id="breed-filter">Breed</a></li>
                <li><a href="#" id="size-filter">Size</a></li>
                <li><a href="#" id="personality-filter">Personality</a></li>
            </ul>
        </div>
        <input type="text" class="form-control col-9" name="" id="search-text" aria-describedby="helpId" placeholder="Type some information about the doge you want to find" style="display: inline;">
        <a name="" id="search-button" class="btn btn-primary" href="#" role="button" style="display: inline;">Search</a>
    </div>

    <div id="mydoges" style="margin-left: 20em; margin-right: 20em;"></div>

    <div id="bottom-menu" style="display: inline-block;"></div>

    <!-- Register Modal -->
    <div class="modal fade" id="register-modal" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true" style="text-align: left;">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Account</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="row">
                                <div class="form-group col-6">
                                <input type="text"
                                    class="form-control" name="" id="register-name" aria-describedby="helpId" placeholder="Name" required>
                                </div>
                                <div class="form-group col-6">
                                    <input type="text"
                                    class="form-control" name="" id="register-last-name" aria-describedby="helpId" placeholder="Last name" required>
                                </div>
                        </div>
                        <div class="form-group">
                        <input type="email" class="form-control" name="" id="register-email" aria-describedby="helpId" placeholder="Your email" required>
                        </div>
                        <div class="form-group">
                            <input type="password" class="form-control" name="" id="register-password" aria-describedby="helpId" placeholder="Password" pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{6,}$" required>
                        </div>
                        <div class="form-group">
                            <input type="password" class="form-control" name="" id="register-pasword-confirm" aria-describedby="helpId" placeholder="Confirm password" pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{6,}$" required>
                        </div>
                        <div class="form-group">
                            <input type="date" class="form-control" name="" id="register-birth-date" aria-describedby="helpId" max="2020-12-31" required>
                        </div>
                        <div class="form-check border">
                            <div>
                                <label class="form-check-label ml-3">
                                    <input type="radio" class="form-check-input" name="register-radio" id="register-woman" value="checkedValue" required>
                                        Female
                                </label>
                            </div>
                            <div>
                                <label class="form-check-label ml-3">
                                    <input type="radio" class="form-check-input" name="register-radio" id="register-man" value="checkedValue" required>
                                        Male
                                </label>
                            </div>
                        </div>
                        <div class="">&nbsp</div>
                        <div class="form-group">
                            <input type="text" class="form-control" name="" id="register-address" aria-describedby="helpId" placeholder="Your address" required>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" name="" id="register-url" aria-describedby="helpId" placeholder="Profile image URL">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary" id="submit-user">Register</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Doge Edit Modal -->
    <div class="modal fade" id="doge-edit-modal" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true" style="text-align: left;">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit doge</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <input type="text" class="form-control" name="" id="doge-edit-name" aria-describedby="helpId" placeholder="Name" required>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" name="" id="doge-edit-breed" aria-describedby="helpId" placeholder="Breed" required>
                        </div>
                        <div class="form-group">
                          <select class="form-control" name="dog" id="doge-edit-size" required>
                            <option selected disabled>Select a size for your doge</option>
                            <option value="Small">Small</option>
                            <option value="Medium">Medium</option>
                            <option value="Big">Big</option>
                          </select>
                        </div>
                        <div class="form-group">
                            <input type="number" class="form-control" name="" id="doge-edit-age" aria-describedby="helpId" placeholder="Age" required>
                        </div>
                        <div class="form-check border">
                            <div>
                                <label class="form-check-label ml-3">
                                    <input type="radio" class="form-check-input" name="doge-edit-radio" id="doge-edit-female" value="checkedValue" checked required>
                                        Female
                                </label>
                            </div>
                            <div>
                                <label class="form-check-label ml-3">
                                    <input type="radio" class="form-check-input" name="doge-edit-radio" id="doge-edit-male" value="checkedValue" required>
                                        Male
                                </label>
                            </div>
                        </div>
                        <div class="">&nbsp</div>
                        <div class="form-group">
                            <input type="text" class="form-control" name="" id="doge-edit-personality" aria-describedby="helpId" placeholder="Describe your doge's personality in a few words" required>
                        </div>
                        <div class="form-group">
                            <textarea type="text" rows="2" class="form-control" name="" id="doge-edit-needs" aria-describedby="helpId" placeholder="Special needs"></textarea>
                        </div>
                        <div class="form-group">
                            <textarea type="text" rows="2" class="form-control" name="" id="doge-edit-info" aria-describedby="helpId" placeholder="Additional information"></textarea>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" name="" id="doge-edit-image" aria-describedby="helpId" placeholder="Doge's image URL">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary" id="submit-edit">Register</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Doge Register Modal -->
    <div class="modal fade" id="doge-register-modal" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true" style="text-align: left;">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Find your doge a new home!</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                </div>
                <div class="modal-body">
                    <form>

                        <div class="form-group">
                            <input type="text" class="form-control" name="" id="doge-register-name" aria-describedby="helpId" placeholder="Name" required>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" name="" id="doge-register-breed" aria-describedby="helpId" placeholder="Breed" required>
                        </div>
                        <div class="form-group">
                          <select class="form-control" name="dog" id="doge-register-size" required>
                            <option selected disabled>Select a size for your doge</option>
                            <option value="Small">Small</option>
                            <option value="Medium">Medium</option>
                            <option value="Big">Big</option>
                          </select>
                        </div>
                        <div class="form-group">
                            <input type="number" class="form-control" name="" id="doge-register-age" aria-describedby="helpId" placeholder="Age" required>
                        </div>
                        <div class="form-check border">
                            <div>
                                <label class="form-check-label ml-3">
                                    <input type="radio" class="form-check-input" name="doge-register-radio" id="doge-register-female" value="checkedValue" checked>
                                        Female
                                </label>
                            </div>
                            <div>
                                <label class="form-check-label ml-3">
                                    <input type="radio" class="form-check-input" name="doge-register-radio" id="doge-register-male" value="checkedValue">
                                        Male
                                </label>
                            </div>
                        </div>
                        <div class="">&nbsp</div>
                        <div class="form-group">
                            <input type="text" class="form-control" name="" id="doge-register-personality" aria-describedby="helpId" placeholder="Describe your doge's personality in a few words" required>
                        </div>
                        <div class="form-group">
                            <textarea type="text" rows="2" class="form-control" name="" id="doge-register-needs" aria-describedby="helpId" placeholder="Special needs"></textarea>
                        </div>
                        <div class="form-group">
                            <textarea type="text" rows="2" class="form-control" name="" id="doge-register-info" aria-describedby="helpId" placeholder="Additional information"></textarea>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" name="" id="doge-register-image" aria-describedby="helpId" placeholder="Doge's image URL">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary" id="submit-doge">Register</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal fade" id="login-modal" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true" style="text-align: left;">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                    <div class="modal-header">
                            <h5 class="modal-title">Login</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                        </div>
                <div class="modal-body">
                    <div class="form-group ml-2 mr-5">
                        <label for="login-email">Email</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <div class="input-group-text">
                                    <i class="fas fa-user"></i>
                                </div>
                            </div>
                            <input type="email" class="form-control" id="login-email" aria-describedby="helpId" placeholder="Your email" required>
                        </div>
                    </div>
                    <div class="form-group ml-2 mr-5">
                        <label for="login-password">Password</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <div class="input-group-text">
                                    <i class="fas fa-key"></i>
                                </div>
                            </div>
                            <input type="password" class="form-control" id="login-password" aria-describedby="helpId" placeholder="Password" required>
                        </div>
                    </div>
                </div>
                <div class="modal-footer w-100">
                    <div class="flex-column">
                        <div class="w-100 d-flex justify-content-end">
                            <button type="button" class="btn btn-secondary mr-2" data-dismiss="modal" id="login-cancel">Cancel</button>
                            <button type="submit" class="btn btn-primary" data-dismiss="modal" id="submit-login">Login</button>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="mx-4 border-top"></div>
                    <div class="mx-4 mt-3 mb-1 d-flex justify-content-end">
                        <p>Not registered yet?&nbsp</p>
                        <a href="#" data-toggle="modal" data-target="#register-modal" data-dismiss="modal">Register now!</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal fade" id="delete-modal" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Delete doge</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete the doge with the following ID?: <div id="delete-warning"></div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button id="delete-button" type="button" class="btn btn-primary" data-dismiss="modal" onclick="deleteDoge()">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Optional JavaScript -->
    <script>
        // Must change limit in both Doge.js and here
        let limit = 5;
        let currentPage = 1;
        let currentFilter =  'name';
        let currentSearch = '';
        let dogeSelected;

        let registerModal = document.getElementById("register-modal");
        let registerButton = document.getElementById("submit-user");
        let dogeRegisterModal = document.getElementById("doge-register-modal");
        let dogeRegisterButton = document.getElementById("submit-doge");
        let loginModal = document.getElementById("login-modal");
        let loginButton = document.getElementById("submit-login");
        let searchButton = document.getElementById('search-button');
        let deleteModal = document.getElementById('delete-modal');
        let editModal = document.getElementById('doge-edit-modal');
        let editButton = document.getElementById('submit-edit');

        function validateRegister() 
        {
            let password = registerModal.querySelector("#register-password");
            let passwordConfirm = registerModal.querySelector("#register-pasword-confirm");

            registerButton.disabled = true;  
            password.setCustomValidity("Invalid field.");
            passwordConfirm.setCustomValidity("Invalid field.");
            
            if(password.value != passwordConfirm.value)
                return;

            password.setCustomValidity("");
            passwordConfirm.setCustomValidity("");

            if(registerModal.querySelectorAll(":invalid").length > 0)
                return;

            registerButton.disabled = false; 
        }

        function submitRegister() 
        {
            let url = 'https://dogeempire.herokuapp.com/api/users';

            let xhr = new XMLHttpRequest();
            xhr.open('POST', url);
            xhr.setRequestHeader('Content-Type', 'application/json');

            let sex;
            if(registerModal.querySelector('#register-woman').checked == true)
                sex = 'Female';
            else
                sex = 'Male';

            let img = registerModal.querySelector('#register-url').value;
            if(img == '')
            {
                img = 'https://www.pngfind.com/pngs/m/470-4703547_icon-user-icon-hd-png-download.png';
            }

            let data = 
            {
                "name": registerModal.querySelector('#register-name').value,
                "lastName": registerModal.querySelector('#register-last-name').value,
                "email": registerModal.querySelector('#register-email').value,
                "image": img,
                "sex": [sex],
                "birthdate": registerModal.querySelector('#register-birth-date').value,
                "password": registerModal.querySelector('#register-password').value,
                "address": registerModal.querySelector('#register-address').value
            }
            xhr.send(JSON.stringify(data));

            xhr.onload = function()
            {
                if(xhr.status == 201) 
                {
                    document.getElementById('alerts').innerHTML = `
                    <div class="alert alert-success alert-dismissible" role="alert">
                        User successfully registered.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    `
                }
                else 
                {
                    document.getElementById('alerts').innerHTML = `
                    <div class="alert alert-danger alert-dismissible " role="alert">
                        User could not be registered.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    `
                }
            }

            $('#register-modal')
                .find("input,textarea,select")
                    .val('')
                    .end()
                .find("input[type=checkbox], input[type=radio]")
                    .prop("checked", "")
                    .end();

            $('#register-modal').modal('toggle');
        }

        function validateLogin()
        {
            if(loginModal.querySelectorAll(":invalid").length > 0)
            {
                loginButton.disabled = true;
            }
            else
            {
                loginButton.disabled = false;
            }
        }

        function submitLogin() 
        {
            let loginEmail = document.getElementById('login-email').value;
            let loginPassword = document.getElementById('login-password').value;

            let url = 'https://dogeempire.herokuapp.com/api/auth/login';

            let xhr = new XMLHttpRequest();
            xhr.open('POST', url);
            xhr.setRequestHeader('Content-Type', 'application/json');

            let data = 
            {
                "email": loginEmail,
                "password": loginPassword
            }

            xhr.send(JSON.stringify(data));

            xhr.onload = function()
            {
                if(xhr.status == 200) 
                {
                    sessionStorage.token = JSON.parse(xhr.response).token;
                    sessionStorage.user = loginEmail;
                    window.location.href = "index.html";
                }
                else 
                {
                    document.getElementById('alerts').innerHTML = `
                    <div class="alert alert-danger alert-dismissible " role="alert">
                        Invalid information.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    `
                }
            }
        }

        function validateDogeUpdate()
        {
            if(editModal.querySelectorAll(":invalid").length > 0)
            {
                editButton.disabled = true;
            }
            else
            {
                editButton.disabled = false;
            }
        }

        function validateDogeRegister()
        {
            if(dogeRegisterModal.querySelectorAll(":invalid").length > 0)
            {
                dogeRegisterButton.disabled = true;
            }
            else
            {
                dogeRegisterButton.disabled = false;
            }
        }

        function submitDogeRegister()
        {
            let url = 'https://dogeempire.herokuapp.com/api/doges';

            let xhr = new XMLHttpRequest();
            xhr.open('POST', url);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.setRequestHeader('x-auth', sessionStorage.token);

            let size = $('#doge-register-size option:selected');

            let sex;
            if(dogeRegisterModal.querySelector('#doge-register-female').checked == true)
                sex = 'Female';
            else
                sex = 'Male';

            let rId = Math.floor(Math.random() * (99999));
            let data = 
            {
                "uid": rId,
                "name": dogeRegisterModal.querySelector('#doge-register-name').value,
                "breed": dogeRegisterModal.querySelector('#doge-register-breed').value,
                "size": [document.getElementById('doge-register-size').value],
                "sex": [sex],
                "age": dogeRegisterModal.querySelector('#doge-register-age').value,
                "owner": sessionStorage.user,
                "information": dogeRegisterModal.querySelector('#doge-register-info').value,
                "image": dogeRegisterModal.querySelector('#doge-register-image').value,
                "personality": dogeRegisterModal.querySelector('#doge-register-personality').value
            }
            xhr.send(JSON.stringify(data));

            xhr.onload = function()
            {
                if(xhr.status == 201) 
                {
                    document.getElementById('alerts').innerHTML = `
                    <div class="alert alert-success alert-dismissible" role="alert">
                        Doge successfully registered.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    `
                }
                else 
                {
                    document.getElementById('alerts').innerHTML = `
                    <div class="alert alert-danger alert-dismissible " role="alert">
                        Doge could not be registered.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    `
                }

                currentPage = 1;
                currentSearch = '';
                document.getElementById('search-text').value = '';
                displayMyDoges(currentPage, currentSearch);
            }

            $('#doge-register-modal')
                .find("input,textarea,select")
                    .val('')
                    .end()
                .find("input[type=checkbox], input[type=radio]")
                    .prop("checked", "")
                    .end();

            $('#doge-register-modal').modal('toggle');

        }

        let menuLogout = document.getElementById('logout-menu-button');
        function filterMenuButtons()
        {  
            let menuLogin = document.getElementById('login-menu-button');
            let menuRegisterDoge = document.getElementById('register-doge-menu-button');
            let menuMyDoges = document.getElementById('mydoges-menu-button');

            if(sessionStorage.getItem('token'))
            {
                menuLogin.hidden = true;
                menuRegisterDoge.hidden = false;
                menuLogout.hidden = false;
                menuMyDoges.hidden = false;
            }
            else 
            {
                menuLogin.hidden = false;
                menuRegisterDoge.hidden = true;
                menuLogout.hidden = true;
                menuMyDoges.hidden = true;
            }
        }

        function logout()
        {
            sessionStorage.removeItem("token");
            window.location.href = "index.html";
        }

        function showDeleteConfirmation(uid)
        {
            if(uid == undefined)
                return;

            dogeSelected = uid;
            deleteModal.querySelector('#delete-warning').innerHTML = uid;
            $('#delete-modal').modal();
        }

        function deleteDoge()
        {
            if(dogeSelected == undefined)
                return;

            let url = 'https://dogeempire.herokuapp.com/api/doges/' + dogeSelected;
            let xhr = new XMLHttpRequest();
            xhr.open('DELETE', url);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.setRequestHeader('x-auth', sessionStorage.token);
            xhr.send();

            xhr.onload = function() 
            {
                if(xhr.status == 200) 
                {
                    document.getElementById('alerts').innerHTML = `
                    <div class="alert alert-success alert-dismissible" role="alert">
                        User deleted.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    `
                    currentPage = 1;
                    currentSearch = '';
                    displayMyDoges(currentPage, currentSearch);
                }
                else 
                {
                    document.getElementById('alerts').innerHTML = `
                    <div class="alert alert-warning alert-dismissible " role="alert">
                        Could not delete user.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    `
                }
            }
        }

        function editDoge(uid)
        {
            if(uid == undefined)
                return;
            
            let url = 'https://dogeempire.herokuapp.com/api/doges/' + uid;
            let xhr = new XMLHttpRequest();
            xhr.open('GET', url);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.setRequestHeader('x-auth', sessionStorage.token);
            xhr.send();

            xhr.onload = function() 
            {
                if(xhr.status != 200)
                    return null;
                
                let doge = JSON.parse(xhr.response);
                
                $('#doge-edit-modal').modal()
                .find("#doge-edit-name").val(doge.name).end()
                .find("#doge-edit-breed").val(doge.breed).end()
                .find("#doge-edit-size").val([doge.size]).end()
                .find("#doge-edit-age").val(doge.age).end()
                .find("#doge-edit-personality").val(doge.personality).end()
                .find("#doge-edit-needs").val(doge.needs).end()
                .find("#doge-edit-info").val(doge.information).end()
                .find("#doge-edit-image").val(doge.image).end()

                dogeSelected = doge;
            }
        }

        function updateDoge()
        {
            if(dogeSelected.uid == undefined);
            let url = 'https://dogeempire.herokuapp.com/api/doges/' + dogeSelected.uid;

            let xhr = new XMLHttpRequest();
            xhr.open('PUT', url);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.setRequestHeader('x-auth', sessionStorage.token);

            let sex;
            if(editModal.querySelector('#doge-edit-female').checked)
                sex = 'Female';
            else
                sex = 'Male';

            let data = 
            {
                "name": editModal.querySelector('#doge-edit-name').value,
                "breed": editModal.querySelector('#doge-edit-breed').value,
                "size": [editModal.querySelector('#doge-edit-size').value],
                "sex": [sex],
                "age": editModal.querySelector('#doge-edit-age').value,
                "personality": editModal.querySelector('#doge-edit-personality').value,
                "needs": editModal.querySelector('#doge-edit-needs').value,
                "information": editModal.querySelector('#doge-edit-info').value,
                "image": editModal.querySelector('#doge-edit-image').value
            }

            xhr.send(JSON.stringify(data));
            xhr.onload = function()
            {
                if(xhr.status == 200) 
                {
                    document.getElementById('alerts').innerHTML = `
                    <div class="alert alert-success alert-dismissible" role="alert">
                        Doge updated.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    `

                    displayMyDoges(currentPage, currentSearch);
                }
                else 
                {
                    document.getElementById('alerts').innerHTML = `
                    <div class="alert alert-warning alert-dismissible " role="alert">
                        Could not update doge.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    `
                }
            }
        }

        function openDogeDetails(uid)
        {
            if(uid == undefined)
                return;
            
            window.location.href = "https://dogeempire.herokuapp.com/doge.html?uid=" + uid;
            return false;
        }

        function displayMyDoges(page, data)
        {
            let url;
            switch(currentFilter)
            {
                case 'name':
                    url = 'https://dogeempire.herokuapp.com/api/doges?name=' + data + '&';
                    break;

                case 'breed':
                    url = 'https://dogeempire.herokuapp.com/api/doges?breed=' + data + '&';
                    break;

                case 'size':
                    url = 'https://dogeempire.herokuapp.com/api/doges?size=' + data + '&';
                    break;

                case 'personality':
                    url = 'https://dogeempire.herokuapp.com/api/doges?personality=' + data + '&';
                    break;

                default:
                    url = 'https://dogeempire.herokuapp.com/api/doges?'
            }
            url += 'page=' + page + "&owner=" + sessionStorage.user;
            let myDogesDiv = document.getElementById('mydoges');

            let xhr = new XMLHttpRequest();
            xhr.open('GET', url);
            xhr.send();
            xhr.onload = function() 
            {
                if(xhr.status != 200)
                    return null;
                
                let doges = JSON.parse(xhr.response);
                let n = doges.pop();
                myDogesDiv.innerHTML = "";

                for(let doge of doges)
                {
                    myDogesDiv.innerHTML += 
                        `
                        <div class="media m-2 border rounded color-primary" style="text-align: left;">
                            <div class="media-left align-self-center m-3">
                                <img src="${doge.image}" class="img-fluid rounded-circle" alt="" style="width: 10em; height: 10em;">
                            </div>
                            <div class="media-body align-self-center ml-3">
                                <a href="javascript:void(0);" onclick="openDogeDetails(${doge.uid})">
                                    <h2 href="#">${doge.name}</h2>
                                </a>
                                <div>Breed: ${doge.breed}</div>
                                <div>Sex: ${doge.sex}</div>
                                <div>Age: ${doge.age}</div>
                            </div>

                            <div class="media-right align-self-center mr-4">
                                <a href="javascript:void(0);" onclick="editDoge(${doge.uid})">
                                    <i class="far fa-edit fa-2x" aria-hidden style="color: #f6648C;"></i>
                                </a>
                                <a href="javascript:void(0);" onclick="showDeleteConfirmation(${doge.uid})">
                                    <i class="far fa-trash-alt fa-2x" aria-hidden style="color: #f6648C;"></i>
                                </a>
                                <br/><br/><br/><br/><br/><br/>
                            </div>
                        </div>
                        `
                }

                let max = Math.ceil(Number(n.n) / Number(limit));
                displayPagination(page, max);
            }
        }

        let bottomMenu = document.getElementById('bottom-menu');
        function displayPagination(current, max)
        {
            bottomMenu.innerHTML = 
            `<nav aria-label="Page navigation" id="full-pagination">
                <ul class="pagination mt-4 mx-2" style="justify-content: center;">
                <li id="prev-button" class="page-item">
                    <a class="page-link" href="#" aria-label="Previous">
                    <span aria-hidden="true">Previous</span>
                    <span class="sr-only">Previous</span>
                    </a>
                </li>
                <div id="pagination"></div>
                <li id="next-button" class="page-item">
                    <a class="page-link" href="#" aria-label="Next">
                    <span aria-hidden="true">Next</span>
                    <span class="sr-only">Next</span>
                    </a>
                </li>
                </ul>
            </nav>`

            if(max > 7)
                max = 7;
            
            let paginationDiv = document.getElementById('pagination');
            let prevButton = bottomMenu.querySelector('#prev-button');
            let nextButton = bottomMenu.querySelector('#next-button');
            paginationDiv.innerHTML = "";

            let firstIndex = current - 3;
            if(firstIndex < 1)
                firstIndex = 1;
                
            for(let i = firstIndex; i <= max; i++)
            {
                if(i == current)
                {
                    paginationDiv.innerHTML += `<li class="page-item active" style="display: inline-block;"><a class="page-link" href="#">${i}</a></li>`
                }
                else
                {
                    paginationDiv.innerHTML += `<li class="page-item" style="display: inline-block;"><a class="page-link" href="#">${i}</a></li>`
                }
            }

            if(current <= 1)
                prevButton.classList.add('disabled'); 
            else
                prevButton.classList.remove('disabled');

            if(current >= max)
                nextButton.classList.add('disabled'); 
            else
                nextButton.classList.remove('disabled');
        }

        let nameFilter = document.getElementById('name-filter');
        let breedFilter = document.getElementById('breed-filter');
        let sizeFilter = document.getElementById('size-filter');
        let personalityFilter = document.getElementById('personality-filter');

        // ON START
        validateRegister();
        validateDogeRegister();
        validateLogin();
        filterMenuButtons();
        displayMyDoges(currentPage, document.getElementById('search-text').value);

        // LISTENERS 
        nameFilter.addEventListener("click", function()
        {
            document.getElementById('current-filter').innerText = 'Name';
            currentFilter = 'name';
        })

        breedFilter.addEventListener("click", function()
        {
            document.getElementById('current-filter').innerText = 'Breed';
            currentFilter = 'breed';
        })

        sizeFilter.addEventListener("click", function()
        {
            document.getElementById('current-filter').innerText = 'Size';
            currentFilter = 'size';
        })

        personalityFilter.addEventListener("click", function()
        {
            document.getElementById('current-filter').innerText = 'Personality';
            currentFilter = 'personality';
        })

        registerModal.addEventListener("input", function () 
        {
            validateRegister();
        })

        loginModal.addEventListener("input", function()
        {
            validateLogin();
        })

        registerButton.addEventListener("click", function(event) 
        {
            event.preventDefault();
            submitRegister();
        })

        loginButton.addEventListener("click", function(event) 
        {
            event.preventDefault();
            submitLogin();
        })

        editModal.addEventListener('input', function(event)
        {
            event.preventDefault();
            validateDogeUpdate();
        })

        editButton.addEventListener('click', function(event)
        {
            event.preventDefault();
            updateDoge();
            $('#doge-edit-modal').modal('toggle');
            return false;
        })

        dogeRegisterModal.addEventListener('input', function(event)
        {
            event.preventDefault();
            validateDogeRegister();
        })

        dogeRegisterButton.addEventListener('click', function(event)
        {
            event.preventDefault();
            submitDogeRegister();
        })

        menuLogout.addEventListener("click", function(event)
        {
            event.preventDefault();
            logout();
        })

        searchButton.addEventListener('click', function(event)
        {
            event.preventDefault();
            currentPage = 1;
            currentSearch = document.getElementById('search-text').value;
            displayMyDoges(currentPage, currentSearch);
        })

        bottomMenu.addEventListener("click", function(event)
        {
            if(event.target.classList.contains('disabled'))
                return;
            
            let action = event.target.innerText;
            if(action == 'Previous')
                displayMyDoges(--currentPage, currentSearch);
            else if(action == 'Next')
                displayMyDoges(++currentPage, currentSearch);
            else
            {
                displayMyDoges(Number(action), currentSearch);
                currentPage = action;
            }
        })
    </script>

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </body>
</html>